# Environment Variables Management Guide

## 🎯 Overview

This project has **two separate applications** with different environment variable needs:
1. **Backend/CLI** (root directory) - TypeScript orchestrator
2. **Web Interface** (web-interface directory) - Next.js app

## 📁 Correct Structure

```
social-network-sync/
├── .env                           # Backend local development (gitignored)
├── .env.example                   # Backend template (committed)
├── .gitignore                     # Protects all .env files
│
├── web-interface/
│   ├── .env.local                 # Frontend local dev (gitignored)
│   ├── .env.example               # Frontend template (committed)
│   └── .gitignore                 # Additional protection
│
└── .vercel/                       # Vercel CLI metadata (gitignored)
    ├── .env.preview.local         # Auto-generated by Vercel
    └── project.json               # Project settings
```

## 🔒 Security Rules

### ✅ DO:
- Keep `.env.example` files with placeholder values
- Use `.env.local` for web-interface (Next.js convention)
- Use `.env` for root/backend development
- Store production secrets in Vercel dashboard
- Commit only `.env.example` files
- Review `git status` before committing

### ❌ DON'T:
- Never commit `.env` or `.env.local` files
- Never put real API keys in `.env.example`
- Never edit `.vercel/.env.preview.local` manually
- Don't duplicate variables across files unnecessarily

## 🔧 Environment Variables by Context

### Backend/CLI (.env in root)
```bash
# AI Providers
OPENAI_API_KEY=
CLAUDE_API_KEY=
PERPLEXITY_API_KEY=

# Database
SUPABASE_URL=
SUPABASE_ANON_KEY=

# Social Media APIs
TWITTER_API_KEY=
LINKEDIN_API_KEY=
GOOGLE_CLIENT_ID=
GITHUB_CLIENT_ID=
```

### Web Interface (web-interface/.env.local)
```bash
# Next.js
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=

# Supabase (Frontend)
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=

# API Routes
OPENAI_API_KEY=
CLAUDE_API_KEY=
```

### Vercel Production (Dashboard/CLI)
```bash
# Required for deployment
NEXTAUTH_URL=https://your-app.vercel.app
NEXTAUTH_SECRET=
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# Optional API Keys
OPENAI_API_KEY=
CLAUDE_API_KEY=
PERPLEXITY_API_KEY=
```

## 🚀 Setup Instructions

### Local Development

1. **Backend Setup:**
   ```bash
   cp .env.example .env
   # Edit .env with your actual values
   ```

2. **Frontend Setup:**
   ```bash
   cd web-interface
   cp .env.example .env.local
   # Edit .env.local with your actual values
   ```

### Vercel Deployment

**Option 1: Vercel Dashboard (Recommended)**
1. Go to https://vercel.com/onasis-team/network-sync/settings/environment-variables
2. Add each variable for "Production" environment
3. Redeploy

**Option 2: Vercel CLI**
```bash
cd web-interface
vercel env add NEXTAUTH_SECRET production
vercel env add NEXTAUTH_URL production
# ... add other variables
```

**Option 3: Use the setup script**
```bash
cd web-interface
chmod +x setup-vercel-env.sh
./setup-vercel-env.sh
```

## 🧹 Cleanup Guide

If you have messy environment files:

1. **Run the cleanup script:**
   ```bash
   chmod +x cleanup-env.sh
   ./cleanup-env.sh
   ```

2. **Manual cleanup:**
   ```bash
   # Check what's tracked in git
   git ls-files | grep .env
   
   # Should only show .env.example files
   # If you see .env files, remove them:
   git rm --cached .env
   git rm --cached web-interface/.env
   git commit -m "Remove accidentally committed env files"
   ```

3. **Verify protection:**
   ```bash
   # Test .gitignore
   touch test.env
   git status  # Should NOT show test.env
   rm test.env
   ```

## 🔍 Troubleshooting

### "Environment variable not found" in Vercel build
- Check Vercel dashboard for missing variables
- Ensure `NEXT_PUBLIC_*` prefix for client-side variables
- Redeploy after adding variables

### Duplicate variable definitions
- Backend vars go in root `.env`
- Frontend vars go in `web-interface/.env.local`
- Don't duplicate unless necessary

### `.vercel` folder issues
- This folder is auto-managed by Vercel CLI
- Should be gitignored (already configured)
- Don't edit files inside manually

### Build fails with "Invalid URL"
- Usually means placeholder values in env vars
- Update Vercel environment variables with real values
- Check Supabase URL format: `https://xxx.supabase.co`

## 📊 Verification Checklist

- [ ] Only `.env.example` files are committed to git
- [ ] All `.env` and `.env.local` files are gitignored
- [ ] `.vercel/` directory is gitignored
- [ ] Production secrets are in Vercel dashboard, not in code
- [ ] No placeholder values in actual `.env` files
- [ ] `git status` shows no environment files

## 🔐 What to Store Where

| Variable Type | Root .env | web-interface/.env.local | Vercel Dashboard |
|--------------|-----------|--------------------------|------------------|
| Backend APIs | ✅ | ❌ | ❌ |
| Frontend Public | ❌ | ✅ (NEXT_PUBLIC_*) | ✅ |
| Frontend Private | ❌ | ✅ | ✅ |
| NextAuth | ❌ | ✅ | ✅ |
| Supabase | ✅ Backend / ✅ Frontend | ✅ | ✅ |

## 🎓 Best Practices

1. **Use environment-specific files:**
   - `.env.local` for local development (highest priority)
   - `.env.development` for dev-specific settings
   - `.env.production` managed by Vercel

2. **Naming conventions:**
   - `NEXT_PUBLIC_*` for client-side accessible variables
   - Regular names for server-side only variables

3. **Security:**
   - Rotate API keys regularly
   - Use different keys for dev/staging/production
   - Never log environment variables

4. **Documentation:**
   - Keep `.env.example` files updated
   - Document required vs optional variables
   - Add comments explaining usage

## 📚 References

- [Next.js Environment Variables](https://nextjs.org/docs/basic-features/environment-variables)
- [Vercel Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)
- [Git Security Best Practices](https://docs.github.com/en/code-security/secret-scanning/about-secret-scanning)
